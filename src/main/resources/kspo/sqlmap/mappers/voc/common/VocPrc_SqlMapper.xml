<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.kspo.voc.kspo.common.dao.IVocPrcDao">

<!--    <resultMap type="com.kspo.voc.kspo.setting.model.VocActivityVo" id="VocActivityVo">-->
<!--        <result property="explanation"  column="EXPLANATION"  jdbcType="CLOB" javaType="java.lang.String" />-->
<!--    </resultMap>-->

    <sql id="vocMgmtCdCols">
        MGMT_CD,
        TOP_MGMT_CD,
        PRNTS_MGMT_CD,
        TOP_COMN_CD,
        COMN_CD,
        MGMT_CD_ORDR,
        MGMT_CD_LVL_NO,
        MGMT_CD_NM,
        USE_YN,
        REGR_ID,
        REG_DT,
        AMDR_ID,
        AMD_DT
    </sql>

    <select id="selectVocMgmtCdTree" resultType="com.kspo.voc.kspo.setting.model.VocMgmtCdVo">
        select
            <include refid="vocMgmtCdCols"/>
        from
            TB_VOC_MGMT_CD_BAS
        <where>
            <if test="topComnCd != null and !topComnCd.equals('')">
                TOP_COMN_CD = #{topComnCd}
            </if>
            <!-- 단건의 분류코드 그룹 호출 시 -->
            <if test="comnCd instanceof String">
                AND
                COMN_CD = #{comnCd}
            </if>
            <!-- 여러개의 분류코드 그룹 호출 시 -->
            <if test="comnCd instanceof java.util.ArrayList">
                AND
                COMN_CD IN
                <foreach collection="comnCd" item="item" separator="," open="(" close=")">
                    #{item}
                </foreach>
            </if>
        </where>
        order by
            MGMT_CD
    </select>

    <select id="selectMgmtCd" resultType="com.kspo.voc.kspo.setting.model.VocMgmtCdVo">
        select
            <include refid="vocMgmtCdCols"/>
        from
            TB_VOC_MGMT_CD_BAS
        <where>
            <if test="mgmtCd != null and !mgmtCd.equals('')">
                MGMT_CD = #{mgmtCd}
            </if>
            <if test="mgmtCd == null and prntsMgmtCd != null and !prntsMgmtCd.equals('')">
                AND
                MGMT_CD = #{prntsMgmtCd}
            </if>
        </where>
    </select>

    <select id="selectPrcdBas" resultType="com.kspo.voc.kspo.setting.model.VocPrcdBasVo">
        SELECT
            *
        FROM
            TB_VOC_PRCD_BAS
        WHERE
            PRCD_CD = #{prcdCd}
    </select>

    <select id="selectPrcdBasList" resultType="com.kspo.voc.kspo.setting.model.VocPrcdBasVo">
        SELECT
            *
        FROM
            TB_VOC_PRCD_BAS
        WHERE
            VOC_APPLY_YN = 'Y'
        ORDER BY
            PRCD_CD
    </select>

    <select id="selectTaskBasList" resultType="com.kspo.voc.kspo.setting.model.VocTaskBasVo">
        SELECT
            *
        FROM
            TB_VOC_TASK_BAS
        <where>
            <if test="autoApplyAllPrcdYn != null and !autoApplyAllPrcdYn.equals('')">
                AUTO_APPLY_ALL_PRCD_YN = #{autoApplyAllPrcdYn}
            </if>
            <if test="autoApplyPrcdCd != null and !autoApplyPrcdCd.equals('')">
                or
                AUTO_APPLY_PRCD_CD = #{autoApplyPrcdCd}
            </if>
            <if test="mcPrcdCd != null and !mcPrcdCd.equals('')">
                TASK_CD NOT IN (
                    SELECT
                        TASK_CD
                    FROM
                        TB_VOC_MC_TASK_DTL
                    WHERE
                        MC_PRCD_CD = #{mcPrcdCd}
                )
            </if>
        </where>
    </select>




</mapper>
